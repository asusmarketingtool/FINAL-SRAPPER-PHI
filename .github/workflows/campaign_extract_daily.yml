name: Daily Extracts (Campaign + Ads Dialog) Chile 10:00

on:
  schedule:
    # 10:00 en Chile (UTC-3) ‚Üí 13:00 UTC
    - cron: "0 13 * * *"
  workflow_dispatch: {}    # manual: siempre corre

jobs:
  daily-extracts:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright gspread google-auth
          python -m playwright install --with-deps chromium

      # 1Ô∏è‚É£ Campaign Extract
      - name: Run Campaign Extract
        env:
          GCP_SA_JSON: ${{ secrets.GCP_SA_JSON }}
        run: |
          echo "üöÄ Iniciando Campaign Extract..."
          python campaign_extract_to_sheets.py
          echo "‚úÖ Campaign Extract finalizado."

      # 2Ô∏è‚É£ Ads Dialog Extract (actualiza EXTRACT_LIM)
      - name: Run Ads Dialog Extract
        env:
          GCP_SA_JSON: ${{ secrets.GCP_SA_JSON }}
        run: |
          echo "üöÄ Iniciando Ads Dialog Extract..."
          python test_ads_dialog_extract_v6.py
          echo "‚úÖ Ads Dialog Extract finalizado."
